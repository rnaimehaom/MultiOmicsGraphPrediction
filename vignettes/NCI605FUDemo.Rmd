
---
title: "NCI-60 5-FU Demo"
author: "Tara Eicher"
date: "4/01/2022"
output: rmarkdown::html_document
vignette: >
  %\VignetteIndexEntry{MultiOmicsGraphPrediction NCI60 5FU}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---
# Set up.
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
result_dir <- "~\\Ensemble_5fu_vignette_results"
dir.create(result_dir)
```

# Install the packages.
```{r eval = FALSE}
if(!require("devtools")){
  install.packages("devtools")
}
library("devtools")
if(!require("MultiOmicsGraphPrediction")){
  install_github("ncats/MultiOmicsGraphPrediction")
}
library(MultiOmicsGraphPrediction)
if(!require("IntLIM")){
  install_github("ncats/IntLIM")
}
library(IntLIM)
```

# Import data files.
The files below are used to determine pathway membership. Note that a future version may
automatically integrate tables from RaMP.
```{r}
if(!require(data.table)){
  install.packages("data.table")
}
library(data.table)

analyte <- fread("/Volumes/eichertd$/Thesis/aim_2/analyte.txt", sep = "\t", header = FALSE)
analytehaspathway <- fread("/Volumes/eichertd$/Thesis/aim_2/analytehaspathway.txt", sep = "\t", header = FALSE)
pathway <- fread("/Volumes/eichertd$/Thesis/aim_2/pathway.txt", sep = "\t", header = FALSE)
source <- fread("/Volumes/eichertd$/Thesis/aim_2/source.txt", sep = "\t", header = FALSE)
```

# Filter metabolites and genes.

This data includes NCI-60 gene expression and metabolite abundance levels for 57 cell lines. The outcome of interest is response to 5-FU drugs, as reviewed in the following papers: https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3837334/ and https://pubmed.ncbi.nlm.nih.gov/34151400/. From the first paper, we obtained the following list of analytes of interest that are contained within the NCI-60 analyte data:
- dUTP (metabolite)
- FURIN (gene)
- UMPS (gene)
- UPP1 and UPP2 (genes)
- UCK1 (gene)
- RRM2 (genes)
- TYMS (gene)

From the second paper, we obtained the following additional list of analytes. These analytes were shown to be independently altered with respect to 5-FU administration in humans:
- Citric acid (metabolite hmdb:HMDB0000094)
- Malic acid (metabolite hmdb:HMDB0000156)
- Succinate (metabolite hmdb:HMDB0000254)
- Cysteine (metabolite hmdb:HMDB0003417)
- E2F1 (gene ensembl:ENSG00000101412)
- TP53 (gene ensembl:ENSG00000141510)
- TNFSF10 (gene ensembl:ENSG00000121858)

For the second list, we also queried the RaMP GUI (RaMP 2.0, https://rampdb.nih.gov/) for analytes involved in reactions with this list and obtained the following additional analytes:
- For citric acid: CNDP1, APRT, SLCO2B1, CLYBL, BHMT, PDE5A, IL4I1, HS3ST3A1, HS3ST3B1, and OR10H3
- For malic acid: MDH2, FH, ME2, ME1, ME3, and MDH1
- For succinate: TMLHE, ALKBH2, PHYH, P4HA2, P4HA1, BBOX1, PLOD1, PLOD2, PLOD3, and P3H1

5-FU drug response for the NCI-60 cell lines was downloaded from the following link: https://discover.nci.nih.gov/cellminer/downloadquery.do.

## Plot 5-FU Response Distribution
```{r}
# Read and process 5-FU response.
#dir <- system.file("extdata", package="MultiOmicsGraphPrediction", mustWork=TRUE)
dir <- "/Volumes/eichertd$/Ensemble_prediction/inst/extdata"
drugs_5fu <- c("Tegafur", "Capecitabine")
drug_responses_init <- read.csv(paste(dir, "DTP_NCI60_RAW.csv", sep = "/"), header = T, skip = 8)
drug_names <- drug_responses_init$Drug.name
drug_responses_trimmed <- t(drug_responses_init[,10:ncol(drug_responses_init)])
drug_responses <- matrix(as.numeric(drug_responses_trimmed), ncol = ncol(drug_responses_trimmed))
rownames(drug_responses) <- rownames(drug_responses_trimmed)

# Read analyte files.
metabs <- read.csv("/Volumes/eichertd$/IntLIM_vignette_code/IntLIMVignettes/NCI60_data/metabData.csv", row.names = 1)
genes <- read.csv("/Volumes/eichertd$/IntLIM_vignette_code/IntLIMVignettes/NCI60_data/geneData.csv", row.names = 1)
pdata <- read.csv("/Volumes/eichertd$/IntLIM_vignette_code/IntLIMVignettes/NCI60_data/pData.csv", row.names = 1)
row.names(pdata) <- make.names(row.names(pdata))

# Take subset of 5-FU data.
rownames(drug_responses) <- sub("^.*?\\.", "", rownames(drug_responses))
drug_responses <- drug_responses[sort(intersect(colnames(metabs), rownames(drug_responses))),]

# Plot a histogram of the drug info.
# We remove column 13 because all but one value is NA.
which_drugs <- which(drug_names %in% drugs_5fu)
drugs_heatmap <- drug_responses[,which_drugs[-13]]
colnames(drugs_heatmap) <- paste(drug_names[which_drugs[-13]], drug_responses_init$Experiment.name[which_drugs[-13]], sep = " - ")
gplots::heatmap.2(drugs_heatmap, na.color = "gray", tracecol = NA, scale = "none", margins = c(10,5), cexCol = 0.75)

# Take the mean of all but the leftmost four data points.
experiments_of_interest <- c("9402AG15", "8905CS23", "9402SA37", "8904SA83", "8904NS27", "9403SA38", "9403AG16", "8904NS20", "9403SS94", "8904SA76")
drugs_heatmap_filtered <- drugs_heatmap[,paste("Tegafur", experiments_of_interest, sep = " - ")]
drug_levels_mean <- rowMeans(drugs_heatmap_filtered, na.rm = TRUE)
drug_levels_median <- unlist(lapply(1:nrow(drugs_heatmap_filtered), function(i){return(median(drugs_heatmap_filtered[i,], na.rm = TRUE))}))
hist(drugs_heatmap_filtered, breaks = 25, xlim = c(0,6))
hist(drug_levels_mean, breaks = 25, xlim = c(0,6))
hist(drug_levels_median, breaks = 25, xlim = c(0,6))

# Since taking the mean does not provide a wide enough range, we take the experiment that has the fewest NA values. In two experiments,
# there are only 4 missing values each.
count_na <- unlist(lapply(1:ncol(drugs_heatmap_filtered), function(i){return(length(which(is.na(drugs_heatmap_filtered[,i]))))}))
least_na_drugs <- drugs_heatmap_filtered[,which(count_na == 4)]
hist(least_na_drugs[,1], breaks = 25, xlim = c(0,6))
hist(least_na_drugs[,2], breaks = 25, xlim = c(0,6))

# The second of these has the best range. We check to see how much the high values correspond to colon cancer cell lines.
colon_cell_lines <- c("COLO.205", "HCC.2998", "HCT.116", "HCT.15", "HT29", "KM12", "SW.620")
hist(least_na_drugs[colon_cell_lines,2], breaks = 25, xlim = c(0,6))

# Finalize the drug measurements we are using and filter the cell lines.
final_drug <- colnames(drugs_heatmap_filtered)[which(count_na == 4)[2]]
final_cell_lines <- rownames(drugs_heatmap_filtered)[which(!is.na(drugs_heatmap_filtered[,final_drug]))]
shared_samps <- sort(intersect(colnames(metabs), colnames(genes)))
shared_samps <- intersect(shared_samps, final_cell_lines)
metabs <- metabs[,shared_samps]
genes <- genes[,shared_samps]
pdata <- pdata[shared_samps,]
pdata$drug5FU <- least_na_drugs[shared_samps, 2]
```

## Plot Analyte Pair Distribution
```{r}
# List analytes of interest.
metabolites_of_interest <- c(rep("2'-deoxyuridine 5'-triphosphate", 7), rep("citric acid", 11),
                             rep("malic acid", 6), rep("succinate", 9))
genes_of_interest <- c(c("FURIN", "UMPS", "UPP1", "UPP2", "UCK1", "RRM2", "TYMS"),
                       c("CNDP1", "APRT", "SLCO2B1", "CLYBL", "BHMT", "PDE5A", "IL4I1", "HS3ST3A1", "HS3ST3B1", "OR10H3"),
                       c("MDH2", "FH", "ME2", "ME1", "ME3", "MDH1"),
                       c("TMLHE", "ALKBH2", "PHYH", "P4HA2", "P4HA1", "BBOX1", "PLOD1", "PLOD2", "PLOD3", "P3H1"))

# Plot analyte pairs.
for(i in 1:length(metabolites_of_interest)){
  numeric_metab <- as.numeric(metabs[metabolites_of_interest[i],])
  numeric_gene <- as.numeric(genes[genes_of_interest[i],])
  which_neither_na <- intersect(which(!is.na(numeric_metab)), which(!is.na(numeric_gene)))
  str(numeric_gene)
  plot(y = numeric_metab[which_neither_na], 
       x = numeric_gene[which_neither_na],
       xlab = genes_of_interest[i], ylab = metabolites_of_interest[i])
}
```

## Plot Analyte Distribution With Respect to 5-FU
```{r}
metabolites_of_interest <- c("2'-deoxyuridine 5'-triphosphate", "citric acid",
                             "malic acid", "succinate", "cysteine")
genes_of_interest <- c("FURIN", "UMPS", "UPP1", "UPP2", "UCK1", "RRM2", "TYMS",
                       "CNDP1", "APRT", "SLCO2B1", "CLYBL", "BHMT", "PDE5A", "IL4I1", "HS3ST3A1", "HS3ST3B1", "OR10H3",
                       "MDH2", "FH", "ME2", "ME1", "ME3", "MDH1",
                       "TMLHE", "ALKBH2", "PHYH", "P4HA2", "P4HA1", "BBOX1", "PLOD1", "PLOD2", "PLOD3", "P3H1",
                       "E2F1", "TP53", "TNFSF10")

# Plot analyte pairs.
for(i in 1:length(metabolites_of_interest)){
  plot(y = metabs[metabolites_of_interest[i], shared_samps], x = pdata$drug5FU, na.rm = TRUE, 
       ylab = metabolites_of_interest[i], xlab = "Mean Tegafur Score")
}
for(i in 1:length(genes_of_interest)){
  plot(y = genes[genes_of_interest[i], shared_samps], x = pdata$drug5FU, na.rm = TRUE, 
       ylab = genes_of_interest[i], xlab = "Mean Tegafur Score")
}
```

```{r}
# Filter metabolites.
colnames(metabs) <- sample(colnames(metabs), ncol(metabs))
csvtrain <- metabs[metabolites_of_interest,1:40]
csvtest <- metabs[metabolites_of_interest,41:51]
write.csv(csvtrain, "/Volumes/eichertd$/Ensemble_prediction/inst/extdata/metabData5FU_NCI60.train.csv")
write.csv(csvtest, "/Volumes/eichertd$/Ensemble_prediction/inst/extdata/metabData5FU_NCI60.test.csv")

# Filter genes.
colnames(genes) <- colnames(metabs)
csvtrain <- genes[genes_of_interest,1:40]
csvtest <- genes[genes_of_interest,41:51]
write.csv(csvtrain, "/Volumes/eichertd$/Ensemble_prediction/inst/extdata/geneData5FU_NCI60.train.csv")
write.csv(csvtest, "/Volumes/eichertd$/Ensemble_prediction/inst/extdata/geneData5FU_NCI60.test.csv")

# Filter pdata.
rownames(pdata) <- colnames(metabs)
csvtrain <- pdata[1:40,]
csvtest <- pdata[41:51,]
write.csv(csvtrain, "/Volumes/eichertd$/Ensemble_prediction/inst/extdata/pData5FU_NCI60.train.csv")
write.csv(csvtest, "/Volumes/eichertd$/Ensemble_prediction/inst/extdata/pData5FU_NCI60.test.csv")

# Write reference file.
refdata.train <- data.frame(type = c("analyteType2", "analyteType1", "analyteType2MetaData", "analyteType1MetaData", "sampleMetaData"),
                      filenames = c("metabData5FU_NCI60.train.csv", "geneData5FU_NCI60.train.csv", "", "", "pData5FU_NCI60.train.csv"))
refdata.test <- data.frame(type = c("analyteType2", "analyteType1", "analyteType2MetaData", "analyteType1MetaData", "sampleMetaData"),
                      filenames = c("metabData5FU_NCI60.test.csv", "geneData5FU_NCI60.test.csv", "", "", "pData5FU_NCI60.test.csv"))
write.csv(refdata.train, "/Volumes/eichertd$/Ensemble_prediction/inst/extdata/nci60_5FU.train.csv", row.names = FALSE)
write.csv(refdata.test, "/Volumes/eichertd$/Ensemble_prediction/inst/extdata/nci60_5FU.test.csv", row.names = FALSE)
```

Next, we read in the new data.
```{r}
# Import training data.
csvfileTrain <- file.path(dir, "nci60_5FU.train.csv")
inputDataTrain <- IntLIM::ReadData(csvfileTrain)

# Import testing data.
csvfileTest <- file.path(dir, "nci60_5FU.test.csv")
inputDataTest <- IntLIM::ReadData(csvfileTest)
```

# Run IntLIM
```{r}
myres <- IntLIM::RunIntLim(inputData = inputDataTrain,stype="drug5FU",
                                 save.covar.pvals = TRUE, 
                                 outcome = 2, 
                                 independent.var.type = 1, 
                                 continuous = TRUE)
IntLIM::DistPvalues(myres, adjusted = FALSE)
IntLIM::DistRSquared(myres)
IntLIM::InteractionCoefficientGraph(inputResults = myres, 
                                    interactionCoeffPercentile = 0.9,
                                    percentageToPlot = 1)
IntLIM::pvalCoefVolcano(inputResults = myres, inputData = inputDataTrain,
                        pvalcutoff = 0.99)
plot(density(myres@interaction.pvalues), xlab = "Interaction Term Unadjusted p-value", main = "")
plot(density(myres@interaction.adj.pvalues), xlab = "Interaction Term Adjusted p-value", main = "")
plot(density(myres@interaction.coefficients), xlab = "Interaction Term Coefficient", main = "")
plot(density(myres@model.rsquared), xlab = "Model R-squared", main = "")
```

# Filter Results and Create Co-Regulation Graph
Don't actually filter anything. Just output the results in a reasonable format so that we can peruse them.
In a co-regulation graph, nodes are analytes (genes and metabolites) and edges indicate
a significant phenotype-dependent association between the analytes.
```{r}
myres.all <- IntLIM::ProcessResults(inputResults = myres, inputData = inputDataTrain, 
                                       pvalcutoff = 1, rsquaredCutoff = 0)
IntLIM::OutputResults(inputResults=myres.all,filename=paste(result_dir,
                                                                    "nci60Data_5FU_Results.csv"
                                                                    , sep = "/"))
# Build graph.
coreg.all <- MultiOmicsGraphPrediction::BuildCoRegulationGraph(myres.all)
MultiOmicsGraphPrediction::PlotCoRegulationGraph(coreg.all, "All 5-FU Dependent Pairwise Associations (NCI-60)", saveInFile = NULL, vertices = NULL)
```
Filter by R^2 only.
```{r}
myres.r2 <- IntLIM::ProcessResults(inputResults = myres, inputData = inputDataTrain, 
                                       pvalcutoff = 1, rsquaredCutoff = 0.1)
# Build graph.
coreg.r2 <- MultiOmicsGraphPrediction::BuildCoRegulationGraph(myres.r2)
MultiOmicsGraphPrediction::PlotCoRegulationGraph(coreg.r2, "5-FU Dependent Pairwise Associations (NCI-60, R^2 > 0.1)", saveInFile = NULL, vertices = NULL)
```
Filter by interaction coefficient only.
```{r}
myres.icoef <- IntLIM::ProcessResults(inputResults = myres, inputData = inputDataTrain, 
                                       pvalcutoff = 1, rsquaredCutoff = 0, interactionCoeffPercentile = 0.8)
# Build graph.
coreg.icoef <- MultiOmicsGraphPrediction::BuildCoRegulationGraph(myres.icoef)
MultiOmicsGraphPrediction::PlotCoRegulationGraph(coreg.icoef, "5-FU Dependent Pairwise Associations (NCI-60, Icoef perc > 0.8)", saveInFile = NULL, vertices = NULL)
```
Filter by unadjusted p-value only.
```{r}
myres.pval <- myres.all[which(myres.all$Pval < 0.2),]
# Build graph.
coreg.pval <- MultiOmicsGraphPrediction::BuildCoRegulationGraph(myres.pval)
MultiOmicsGraphPrediction::PlotCoRegulationGraph(coreg.pval, "5-FU Dependent Pairwise Associations (NCI-60, pval < 0.2)", saveInFile = NULL, vertices = NULL)
```
Filter by all.
```{r}
myres.sig <- IntLIM::ProcessResults(inputResults = myres, inputData = inputDataTrain, 
                                       pvalcutoff = 1, rsquaredCutoff = 0.1, interactionCoeffPercentile = 0.8)
myres.sig <- myres.sig[which(myres.sig$Pval < 0.2),]

# Build graph.
coreg.sig <- MultiOmicsGraphPrediction::BuildCoRegulationGraph(myres.sig)
MultiOmicsGraphPrediction::PlotCoRegulationGraph(coreg.sig, "5-FU Dependent Pairwise Associations (NCI-60, Filtered)", saveInFile = NULL, vertices = NULL)
```
# Check Stats of "Positive Control" Pairs.
```{r}
metabolites_of_interest <- make.names(c(rep("2'-deoxyuridine 5'-triphosphate", 7), rep("citric acid", 11),
                             rep("malic acid", 6), rep("succinate", 9)))
genes_of_interest <- make.names(c(c("FURIN", "UMPS", "UPP1", "UPP2", "UCK1", "RRM2", "TYMS"),
                       c("CNDP1", "APRT", "SLCO2B1", "CLYBL", "BHMT", "PDE5A", "IL4I1", "HS3ST3A1", "HS3ST3B1", "OR10H3"),
                       c("MDH2", "FH", "ME2", "ME1", "ME3", "MDH1"),
                       c("TMLHE", "ALKBH2", "PHYH", "P4HA2", "P4HA1", "BBOX1", "PLOD1", "PLOD2", "PLOD3", "P3H1")))
pairs_of_interest <- paste(genes_of_interest, metabolites_of_interest, sep = "__")
myres.all <- IntLIM::ProcessResults(inputResults = myres, inputData = inputDataTrain, 
                                       pvalcutoff = 1, rsquaredCutoff = 0, interactionCoeffPercentile = 0)
myres.pairs <- myres.all[pairs_of_interest,]
View(myres.pairs)
plot(density(myres.pairs$interaction_coeff))
lines(density(myres.all$interaction_coeff), col = "red")

plot(density(myres.pairs$Pval))
lines(density(myres.all$Pval, col = "red"), col = "red")

plot(density(myres.pairs$rsquared))
lines(density(myres.all$rsquared, col = "red"), col = "red")
```

# Run Pairwise Prediction.
```{r}
# Run pairwise prediction.
pred <- MultiOmicsGraphPrediction::RunPairwisePrediction(inputResults = myres.sig, 
                                                         inputData = inputDataTrain,
                                                         stype = "drug5FU",
                                                         independentVarType = 1,
                                                         outcomeType = 2)
```

## Project Predictions
```{r plot graph}
# Project graph.
projectedGraph <- MultiOmicsGraphPrediction::ProjectPredictionsOntoGraph(coRegulationGraph = coreg.sig,
                                                                         predictions = pred)
MultiOmicsGraphPrediction::PlotGraphPredictions(graph = projectedGraph, 
                                                inputData = inputDataTrain,
                                                stype = "drug5FU")
```

## Create Model Input
```{r model input}
# Create input.
modelInput <- MultiOmicsGraphPrediction::FormatInput(predictionGraphs = projectedGraph, 
                                                     coregulationGraph = coreg.sig,
                   inputData = inputDataTrain, stype.class = "numeric", stype = "drug5FU",
                   edgeTypeList = c("shared.outcome.analyte", "shared.independent.analyte"))
saveRDS(modelInput,file=paste(result_dir, paste0("nci60_5FUmodelInput.RDS"), sep = "\\"))
```

## Compute Importance Metrics.
```{r importance}
# Format the pathway-related files appropriately.
colnames(analytehaspathway) <- c("RaMPID", "PathID", "database")
metabMeta <- read.csv(file.path(dir, "fData.metab.nci60.csv"), row.names = 1)
colnames(source) <- c("SourceID", "RaMPID", "source", "type", "commonName", "HMDB_status", "source2")
MultiOmicsGraphPrediction::PlotSubspaceClusteringDendrogram(inputData = inputDataTrain, eigStep = 1)
MultiOmicsGraphPrediction::PlotSubspaceClusteringHeatmap(inputData = inputDataTrain, eigStep = 1)
importance <- MultiOmicsGraphPrediction::GetAllImportanceMetrics(predictions = pred, 
                                                                 modelInput = modelInput,
                                                                 inputData = inputDataTrain, 
                                                                 metricList = c("pdf"),
                                                                 k = 2, eigStep = 1,
                                                                 analytehaspathway = analytehaspathway,
                                                                 analyteNamesOut = metabMeta,
                                                                 source = source)
#modelInput <- MultiOmicsGraphPrediction::InitializeWeights(modelInput = modelInput,
#                                                           importance = importance)
modelResults <- MultiOmicsGraphPrediction::InitializeGraphLearningModel(modelInput = modelInput,
                                                                        importance = importance)
# modelResultsPDF <- MultiOmicsGraphPrediction::InitializeGraphLearningModel(modelInput = modelInput,
#                                                                         importance = importance,
#                                                                         initialImportanceWeights = c(1,0,0))
# modelResultsLocal <- MultiOmicsGraphPrediction::InitializeGraphLearningModel(modelInput = modelInput,
#                                                                         importance = importance,
#                                                                         initialImportanceWeights = c(0,1,0))
MultiOmicsGraphPrediction::PlotWeightHeatmap(modelResults = modelResults)
#MultiOmicsGraphPrediction::PlotWeightHeatmap(modelResults = modelResultsPDF)
#MultiOmicsGraphPrediction::PlotWeightHeatmap(modelResults = modelResultsLocal)
MultiOmicsGraphPrediction::PlotLineGraph(modelResults = modelResults, sampSubset = "UACC.62", weights = FALSE, stype = "drug5FU")
```

```{r}
MultiOmicsGraphPrediction::PlotLineGraph(modelResults = modelResults, sampSubset = "UACC.62", weights = TRUE, stype = "drug5FU")
```

## Calculate information gain for when all terms are included in a composite predictor.

Find the set of composite predictors.
```{r}
pairsPredAll <- MultiOmicsGraphPrediction::ObtainCompositeModels(modelInput = modelInput)
for(pairs in pairsPredAll){
  MultiOmicsGraphPrediction::PlotLineGraph(modelResults = modelResults, subset = pairs, sampSubset = "UACC.62", weights = TRUE, stype = "drug5FU")
}
```

```{r}
for(pairs in pairsPredAll){
  compositeModelFull <- MultiOmicsGraphPrediction::CompositePrediction(pairs = pairs, 
                                                                     IntLIMresults = myres,
                                                                     modelResults = modelResults,
                                                                     inputData = inputDataTrain)
  newPredictions <- t(matrix(rep(compositeModelFull, nrow(modelResults@model.input@node.wise.prediction)), ncol = nrow(modelResults@model.input@node.wise.prediction)))
  rownames(newPredictions) <- rownames(modelResults@model.input@node.wise.prediction)
  colnames(newPredictions) <- colnames(modelResults@model.input@node.wise.prediction)
  modelResultsNew <- modelResults
  modelResultsNew@model.input@node.wise.prediction <- newPredictions
  print(ComputeInfoGain(pred = unlist(compositeModelFull), trueVal = inputDataTrain@sampleMetaData[,myres@stype]))
  MultiOmicsGraphPrediction::PlotLineGraph(modelResults = modelResultsNew, subset = pairs, sampSubset = "UACC.62", weights = TRUE, stype = "drug5FU")
}

```

# Compute the information gain with each analtyte left out.
```{r}
pairs <- list(c("TYMS__cysteine", "FH__malic.acid"),
              c("TYMS__cysteine", "FH__cysteine"),
              c("FH__malic.acid", "FH__cysteine"))
for(pair in pairs){
  compositeModelFull <- MultiOmicsGraphPrediction::CompositePrediction(pairs = pair, 
                                                                   IntLIMresults = myres,
                                                                   modelResults = modelResults,
                                                                   inputData = inputDataTrain)
  print(ComputeInfoGain(pred = unlist(compositeModelFull), trueVal = inputDataTrain@sampleMetaData[,myres@stype]))
  newPredictions <- t(matrix(rep(compositeModelFull, nrow(modelResults@model.input@node.wise.prediction)), 
                             ncol = nrow(modelResults@model.input@node.wise.prediction)))
  rownames(newPredictions) <- rownames(modelResults@model.input@node.wise.prediction)
  colnames(newPredictions) <- colnames(modelResults@model.input@node.wise.prediction)
  modelResultsNew <- modelResults
  modelResultsNew@model.input@node.wise.prediction <- newPredictions
  MultiOmicsGraphPrediction::PlotLineGraph(modelResults = modelResultsNew, subset = pair, 
                                         sampSubset = "UACC.62", weights = TRUE, stype = "drug5FU")
}
```
```{r}
pairs <- list(c("MDH2__succinate", "OR10H3__succinate", "TMLHE__succinate"), 
              c("MDH2__succinate", "OR10H3__succinate", "ME2__succinate"),
              c("MDH2__succinate", "TMLHE__succinate", "ME2__succinate"),
              c("OR10H3__succinate", "TMLHE__succinate", "ME2__succinate"))
for(pair in pairs){
  compositeModelFull <- MultiOmicsGraphPrediction::CompositePrediction(pairs = pair, 
                                                                   IntLIMresults = myres,
                                                                   modelResults = modelResults,
                                                                   inputData = inputDataTrain)
  print(ComputeInfoGain(pred = unlist(compositeModelFull), trueVal = inputDataTrain@sampleMetaData[,myres@stype]))
  newPredictions <- t(matrix(rep(compositeModelFull, nrow(modelResults@model.input@node.wise.prediction)), ncol = nrow(modelResults@model.input@node.wise.prediction)))
  rownames(newPredictions) <- rownames(modelResults@model.input@node.wise.prediction)
  colnames(newPredictions) <- colnames(modelResults@model.input@node.wise.prediction)
  modelResultsNew <- modelResults
  modelResultsNew@model.input@node.wise.prediction <- newPredictions
  MultiOmicsGraphPrediction::PlotLineGraph(modelResults = modelResultsNew, subset = pair, sampSubset = "UACC.62",
                                         weights = TRUE, stype = "drug5FU")
}

```
# Plot Prediction
```{r}
compositeModels <- lapply(pairsPredAll, function(pairs){
  print(pairs)
  return(MultiOmicsGraphPrediction::CompositePrediction(pairs = pairs, 
                                                                     IntLIMresults = myres,
                                                                     modelResults = modelResults,
                                                                     inputData = inputDataTrain))
})
plot(compositeModels[[1]], inputDataTrain@sampleMetaData$drug5FU, 
     xlab = "Predicted Value (Composite Model 1)", ylab = "True Value")
plot(compositeModels[[3]], inputDataTrain@sampleMetaData$drug5FU, 
     xlab = "Predicted Value (Composite Model 2)", ylab = "True Value")
plot(compositeModels[[1]], compositeModels[[3]], xlab = "Predicted Value (Composite Model 1)",
     ylab = "Predicted Value (Composite Model 2)")
plot((compositeModels[[1]] + compositeModels[[3]]) / 2, inputDataTrain@sampleMetaData$drug5FU,
     ylab = "True Value", xlab = "Predicted Value (Mean of Both Composite Models)")
plot(MultiOmicsGraphPrediction::CompositePrediction(pairs = "FH__malic.acid", 
                                                                   IntLIMresults = myres,
                                                                   modelResults = modelResults,
                                                                   inputData = inputDataTrain), inputDataTrain@sampleMetaData$drug5FU,
     ylab = "True Value", xlab = "Predicted Value (FH and Malic Acid Pair)")
```

# Compare All Information Gains
```{r}
for(pair in unique(unlist(pairsPredAll))){
  compositeModelFull <- MultiOmicsGraphPrediction::CompositePrediction(pairs = pair, 
                                                                   IntLIMresults = myres,
                                                                   modelResults = modelResults,
                                                                   inputData = inputDataTrain)
  print(paste(pair, ComputeInfoGain(pred = unlist(compositeModelFull), trueVal = inputDataTrain@sampleMetaData[,myres@stype])))
}
```